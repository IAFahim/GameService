@using GameService.Web.Components.Shared
@inherits LayoutComponentBase
@inject NavigationManager Nav

<div class="page">
    <div class="sidebar">
        <NavMenu/>
    </div>

    <main class="bg-light min-vh-100">
        <!-- Top Navigation Bar -->
        <header class="top-row px-4 d-flex justify-content-between align-items-center bg-white border-bottom shadow-sm"
                style="height: 64px;">
            <div class="fw-bold text-dark d-flex align-items-center">
                <span class="badge bg-dark me-2">v1.0</span>
                Admin Dashboard
            </div>

            <div class="d-flex align-items-center gap-3">
                <AuthorizeView>
                    <Authorized Context="authContext">
                        <form class="d-none d-lg-flex align-items-center gap-2 me-2" @onsubmit="JumpToRoom" @onsubmit:preventDefault="true">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>
                                <input class="form-control" placeholder="Jump to Room ID…" aria-label="Room ID" autocomplete="off" @bind="jumpRoomId" />
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-primary">Go</button>
                        </form>

                        <div class="dropdown">
                            <button
                                class="btn btn-link text-decoration-none dropdown-toggle d-flex align-items-center text-dark p-0"
                                type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <div
                                    class="avatar bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center"
                                    style="width: 32px; height: 32px;">
                                    @GetInitial(authContext.User.Identity?.Name)
                                </div>
                                <span class="d-none d-md-inline small fw-bold">@authContext.User.Identity?.Name</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2">
                                <li>
                                    <h6 class="dropdown-header">Account</h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="Account/ChangePassword">
                                        <i class="bi bi-key me-2"></i>Change Password
                                    </a>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li>
                                    <form action="Account/Logout" method="post" class="m-0">
                                        <AntiforgeryToken/>
                                        <input type="hidden" name="ReturnUrl" value=""/>
                                        <button type="submit" class="dropdown-item text-danger">
                                            <i class="bi bi-box-arrow-right me-2"></i>Logout
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </Authorized>
                    <NotAuthorized>
                        <a href="Account/Login" class="btn btn-sm btn-primary px-4 rounded-pill">Login</a>
                    </NotAuthorized>
                </AuthorizeView>
            </div>

@code {
    private string? jumpRoomId;

    private void JumpToRoom()
    {
        var id = jumpRoomId?.Trim();
        if (string.IsNullOrWhiteSpace(id))
            return;

        jumpRoomId = string.Empty;
        Nav.NavigateTo($"games/{Uri.EscapeDataString(id)}");
    }

    private static string GetInitial(string? name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return "?";

        return name.Trim()[0].ToString().ToUpperInvariant();
    }
}

        </header>

        <article class="content px-4 py-4">
            @Body
        </article>
    </main>
</div>

<!-- Toast Notifications Container -->
<ToastContainer/>

<div id="blazor-error-ui" class="alert alert-danger fixed-bottom m-4 shadow-lg" style="display:none; z-index: 1050;">
    <div class="d-flex justify-content-between align-items-center">
        <span><i class="bi bi-exclamation-octagon-fill me-2"></i>An unhandled error has occurred.</span>
        <div>
            <a href="" class="reload btn btn-sm btn-light me-2">Reload</a>
            <button class="dismiss btn btn-sm btn-outline-light"><i class="bi bi-x"></i></button>
        </div>
    </div>
</div>