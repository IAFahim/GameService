# ==========================================
# ğŸ® GAME SERVICE API SUITE
# ==========================================
# Best Dotnet Dev Approved
# Usage: Run "Register", then "Login". Tokens are auto-saved.

# âš™ï¸ Configuration
@hostname = localhost
@port = 5525
@host = http://{{hostname}}:{{port}}
@contentType = application/json

# ğŸ‘¤ Test User Credentials
@username = pro_gamer_99
@email = progamer@gameservice.com
@password = Hunter2!Secure
@newPassword = Hunter3!MoreSecure

# ==========================================
# ğŸ¥ SYSTEM HEALTH
# ==========================================

### Health Check
GET {{host}}/health

### Liveness Check
GET {{host}}/alive

###

# ==========================================
# ğŸ” AUTHENTICATION FLOW
# ==========================================

### 1ï¸âƒ£ Register New User
# Expected: 200 OK with User details
POST {{host}}/auth/register
Content-Type: {{contentType}}

{
  "username": "{{username}}",
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        client.log("âœ… User Registered: " + response.body.username);
    } else if (response.status === 409) {
        client.log("âš ï¸ User already exists (Expected if running twice)");
    }
%}

###

### 2ï¸âƒ£ Login (Get Tokens)
# Expected: 200 OK with Access & Refresh Tokens
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "username": "{{username}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        // ğŸ’¾ Smart Save: Capture both tokens
        client.global.set("auth_token", response.body.accessToken);
        client.global.set("refresh_token", response.body.refreshToken);

        client.log("âœ… Login Success");
        client.log("ğŸ”‘ Access Token: " + response.body.accessToken.substring(0, 15) + "...");
        client.log("ğŸ”„ Refresh Token: " + response.body.refreshToken.substring(0, 15) + "...");
    } else {
        client.log("âŒ Login Failed: " + response.status);
    }
%}

###

### 3ï¸âƒ£ Refresh Token
# Use this when Access Token expires
POST {{host}}/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{refresh_token}}"
}

> {%
    if (response.status === 200) {
        client.global.set("auth_token", response.body.accessToken);
        client.global.set("refresh_token", response.body.refreshToken);
        client.log("âœ… Tokens Refreshed Successfully");
    }
%}

###

### 4ï¸âƒ£ Change Password
# Requires: Valid Bearer Token
POST {{host}}/auth/change-password
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

{
  "oldPassword": "{{password}}",
  "newPassword": "{{newPassword}}"
}

###

### 5ï¸âƒ£ Logout (Revoke Refresh Token)
POST {{host}}/auth/logout
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

###

# ==========================================
# ğŸ‘‘ ADMIN / USER MANAGEMENT
# ==========================================

### Get All Users
# Currently public in dev, implies Admin rights
GET {{host}}/admin/users
Authorization: Bearer {{auth_token}}

###

### Delete User
# Replace '1' with an actual ID from the Get All Users list
DELETE {{host}}/admin/users/1
Authorization: Bearer {{auth_token}}

###

# ==========================================
# ğŸ›¡ï¸ SECURITY & ERROR HANDLING
# ==========================================

### Test: Login with Wrong Password
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "username": "{{username}}",
  "password": "WrongPassword123"
}

> {%
    if (response.status === 401) {
        client.log("âœ… Security Check Passed: 401 Unauthorized received");
    } else {
        client.log("âŒ Security Check Failed: Expected 401");
    }
%}